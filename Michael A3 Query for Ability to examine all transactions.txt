SELECT *
FROM (
    SELECT
        t.TransactionID,
        'Shipping' AS TransactionType,
        s.ActualDate AS TransactionDate,
        p.ProductName,
        src.CompanyName AS SourceCompany,
        dst.CompanyName AS DestinationCompany,
        s.Quantity,
        lsrc.City AS SourceCity,
        lsrc.CountryName AS SourceCountry,
        lsrc.ContinentName AS SourceContinent,
        ldst.City AS DestinationCity,
        ldst.CountryName AS DestinationCountry,
        ldst.ContinentName AS DestinationContinent
    FROM Shipping s
    JOIN InventoryTransaction t ON t.TransactionID = s.TransactionID
    JOIN Product p ON p.ProductID = s.ProductID
    JOIN Company src ON src.CompanyID = s.SourceCompanyID
    JOIN Company dst ON dst.CompanyID = s.DestinationCompanyID
    JOIN Location lsrc ON lsrc.LocationID = src.LocationID
    JOIN Location ldst ON ldst.LocationID = dst.LocationID
    WHERE t.Type = 'Shipping'
      AND s.ActualDate BETWEEN '2019-01-01' AND '2025-12-31'
      AND ('Haynes-Long' IS NULL
           OR src.CompanyName = 'Haynes-Long'
           OR dst.CompanyName = 'Haynes-Long')
      AND ('Manchester' IS NULL
           OR lsrc.City = 'Manchester'
           OR ldst.City = 'Manchester')
      AND ('United Kingdom' IS NULL
           OR lsrc.CountryName = 'United Kingdom'
           OR ldst.CountryName = 'United Kingdom')
      AND ('Europe' IS NULL
           OR lsrc.ContinentName = 'Europe'
           OR ldst.ContinentName = 'Europe')

    UNION ALL

    SELECT
        t.TransactionID,
        'Receiving' AS TransactionType,
        r.ReceivedDate AS TransactionDate,
        p.ProductName,
        src.CompanyName AS SourceCompany,
        rc.CompanyName AS DestinationCompany,
        r.QuantityReceived AS Quantity,
        lsrc.City AS SourceCity,
        lsrc.CountryName AS SourceCountry,
        lsrc.ContinentName AS SourceContinent,
        lrc.City AS DestinationCity,
        lrc.CountryName AS DestinationCountry,
        lrc.ContinentName AS DestinationContinent
    FROM Receiving r
    JOIN InventoryTransaction t ON t.TransactionID = r.TransactionID
    JOIN Shipping s ON s.ShipmentID = r.ShipmentID
    JOIN Product p ON p.ProductID = s.ProductID
    JOIN Company src ON src.CompanyID = s.SourceCompanyID
    JOIN Company rc ON rc.CompanyID = r.ReceiverCompanyID
    JOIN Location lsrc ON lsrc.LocationID = src.LocationID
    JOIN Location lrc ON lrc.LocationID = rc.LocationID
    WHERE t.Type = 'Receiving'
      AND r.ReceivedDate BETWEEN '2019-01-01' AND '2025-12-31'
      AND ('Haynes-Long' IS NULL
           OR src.CompanyName = 'Haynes-Long'
           OR rc.CompanyName = 'Haynes-Long')
      AND ('Manchester' IS NULL
           OR lsrc.City = 'Manchester'
           OR lrc.City = 'Manchester')
      AND ('United Kingdom' IS NULL
           OR lsrc.CountryName = 'United Kingdom'
           OR lrc.CountryName = 'United Kingdom')
      AND ('Europe' IS NULL
           OR lsrc.ContinentName = 'Europe'
           OR lrc.ContinentName = 'Europe')

    UNION ALL

    SELECT
        t.TransactionID,
        'Adjustment' AS TransactionType,
        a.AdjustmentDate AS TransactionDate,
        p.ProductName,
        c.CompanyName AS SourceCompany,
        c.CompanyName AS DestinationCompany,
        a.QuantityChange AS Quantity,
        l.City AS SourceCity,
        l.CountryName AS SourceCountry,
        l.ContinentName AS SourceContinent,
        l.City AS DestinationCity,
        l.CountryName AS DestinationCountry,
        l.ContinentName AS DestinationContinent
    FROM InventoryAdjustment a
    JOIN InventoryTransaction t ON t.TransactionID = a.TransactionID
    JOIN Product p ON p.ProductID = a.ProductID
    JOIN Company c ON c.CompanyID = a.CompanyID
    JOIN Location l ON l.LocationID = c.LocationID
    WHERE t.Type = 'Adjustment'
      AND a.AdjustmentDate BETWEEN '2019-01-01' AND '2025-12-31'
      AND ('Haynes-Long' IS NULL
           OR c.CompanyName = 'Haynes-Long')
      AND ('Manchester' IS NULL
           OR l.City = 'Manchester')
      AND ('United Kingdom' IS NULL
           OR l.CountryName = 'United Kingdom')
      AND ('Europe' IS NULL
           OR l.ContinentName = 'Europe')

) AS Combined
ORDER BY TransactionDate, TransactionID;